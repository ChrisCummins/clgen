# bazel boiler plate mostly taken from rules_go/.travis.yml. See:
#   https://github.com/bazelbuild/rules_go/blob/master/.travis.yml

# trusty beta image has jdk8, gcc4.8.4
# FIXME(linux): dist: trusty
sudo: required
# xcode8 has jdk8
osx_image: xcode8
# Not technically required but suppresses 'Ruby' in Job status message.
language: java

# workaround submodule public key access.
# See: http://stackoverflow.com/a/24600210
git:
  submodules: false

os:
  - linux
  - osx

# FIXME(linux):
# addons:
#   apt:
#     sources:
#       - ubuntu-toolchain-r-test
#     packages:
#       - clang-3.6

before_install:
  - echo 'set -eux' > bootstrap.sh && ./tools/bootstrap.sh >> bootstrap.sh
  - cat bootstrap.sh

script:
  - bash bootstrap.sh
  - source .env
  - echo $CC && $CC --version   # c compiler
  - echo $CXX && $CXX --version  # c++ compiler
  # - bazel query //... | grep -v -f .travisignore  # test targets
  # - |
  #   bazel build --local_resources=400,1,1.0 \
  #       $(bazel query //... | grep -v -f .travisignore)
  # - |
  #   bazel test --local_resources=400,1,1.0 \
  #       $(bazel query //... | grep -v -f .travisignore)

notifications:
  email:
    on_success: change # [always|never|change]
    on_failure: change # [always|never|change]
