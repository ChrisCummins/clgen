# bazel boiler plate mostly taken from rules_go/.travis.yml. See:
#   https://github.com/bazelbuild/rules_go/blob/master/.travis.yml

# trusty beta image has jdk8, gcc4.8.4
# FIXME(linux): dist: trusty
sudo: required
# xcode8 has jdk8
osx_image: xcode8
# Not technically required but suppresses 'Ruby' in Job status message.
language: java

# workaround submodule public key access.
# See: http://stackoverflow.com/a/24600210
git:
  submodules: false

os:
  - linux
  - osx

# FIXME(linux):
# addons:
#   apt:
#     sources:
#       - ubuntu-toolchain-r-test
#     packages:
#       - clang-3.6

before_install:
  - ./tools/http-git-submodules.sh
  - git submodule update --init --recursive

script:
  - ./tools/bootstrap.sh
  # Use `travis_wait 30` prevents the command from being terminated after 10
  # minutes without printing anything to stdout. The reason for no output being
  # printed in 10 minutes is the downloading of the mactex homebrew cask.
  - travis_wait 30 (./tools/bootstrap.sh | bash)
  - source .env
  - echo $CC && $CC --version   # c compiler
  - echo $CXX && $CXX --version  # c++ compiler
  # - bazel query //... | grep -v -f .travisignore  # test targets
  # - |
  #   bazel build --local_resources=400,1,1.0 \
  #       $(bazel query //... | grep -v -f .travisignore)
  # - |
  #   bazel test --local_resources=400,1,1.0 \
  #       $(bazel query //... | grep -v -f .travisignore)
